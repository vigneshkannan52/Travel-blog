!function(p){function n(e){p(".wp-travel-open-uploaded-images ul").children().removeClass("featured-image"),p("#wp_travel_thumbnail_id").val(e),p("#wp-travel-gallery-image-list-"+e).addClass("featured-image")}function i(e){var a=wp.template("my-template"),a=(p(".wp-travel-open-uploaded-images ul").append(a(e)),u(e),wp_travel_drag_drop_uploader._thumbnail_id);n(a=a<1||null==a?p(".wp-travel-open-uploaded-images ul li:first").data("attachmentid"):a)}function u(e){var t=[],a=(p(".wp-travel-open-uploaded-images ul li").each(function(){t.push(p(this).data("attachmentid"))}),0<e.length&&(n(a=(a=wp_travel_drag_drop_uploader._thumbnail_id)<1?p(".wp-travel-open-uploaded-images ul li:first").data("attachmentid"):a),p.each(e,function(e,a){t.push(parseInt(a.id))})),(t=t.filter(Boolean)).filter(function(e,a,t){return a==t.indexOf(e)}));""!=t?(p(".wp-travel-post-tab-content-section-title").show(),p(".wp-travel-open-uploaded-images .description").show()):(p(".wp-travel-post-tab-content-section-title").hide(),p(".wp-travel-open-uploaded-images .description").hide()),p("#wp_travel_gallery_ids").val(a.join(","))}p(function(){var t,l,o,r,d;"undefined"!=typeof wp_travel_drag_drop_uploader&&void 0!==wp_travel_drag_drop_uploader.gallery_data?i(wp_travel_drag_drop_uploader.gallery_data):p(".wp-travel-post-tab-content-section-title").hide(),p(".wp-travel-open-uploaded-images ul").sortable({update:function(){u([])}}),p(document).on("click",".wp-travel-open-uploaded-images ul li",function(){n(p(this).data("attachmentid"))}),p(document).on("click",".wp-travel-open-uploaded-images ul li span",function(){if(!confirm("sure to delete?"))return!1;var e=p(this).parent(),a=e.data("attachmentid"),t=p("#wp_travel_thumbnail_id").val();e.fadeOut("slow",function(){p(this).remove(),t==a&&n(p(".wp-travel-open-uploaded-images ul li:first").data("attachmentid")),u([])})}),p(".wp-travel-open-uploader").wpTravelUploader({media_options:{multiple:!0},onSelect:function(e){i(attachments=e.state().get("selection").toJSON())}}),"undefined"!=typeof uploader&&(p("input#plupload-browse-button").val(wp_travel_drag_drop_uploader.labels.uploader_files_computer),t=p(".wp-travel-upload-progress-bar"),l=p(".wp-travel-upload-progress-bar div.wp-travel-upload-progress-bar-inner"),o=p(".wp-travel-upload-progress-bar div.wp-travel-upload-progress-bar-status"),r=p("#wp-travel-upload-error"),d=0,uploader.bind("FilesAdded",function(e,a){p(r).html(""),d=a.length,p(".uploading .current",p(o)).text("1"),p(".uploading .total",p(o)).text(d),p(".uploading",p(o)).show(),p(".done",p(o)).hide(),p(t).fadeIn()}),uploader.bind("UploadProgress",function(e,a){p(".uploading .current",p(o)).text(d-e.total.queued+1),p(l).css({width:e.total.percent+"%"})}),uploader.bind("FileUploaded",function(e,a,t){t.response.replace(/^<pre>(\d+)<\/pre>$/,"$1").match(/media-upload-error|error-div/)?p(r).html(t.response):p.post(wp_travel_drag_drop_uploader.ajax,{action:"wptravel_load_gallery",nonce:wp_travel_drag_drop_uploader.drag_drop_nonce,id:t.response},function(e){i([e])},"json")}),uploader.bind("UploadComplete",function(){p(".uploading",p(o)).hide(),p(".done",p(o)).show(),setTimeout(function(){p(t).fadeOut()},1e3)}),uploader.bind("Error",function(e,a){p(r).html('<div class="error fade"><p>'+a.file.name+": "+a.message+"</p></div>"),e.refresh()}))})}(jQuery);